# 增强日期选择器使用指南

## 功能概述

增强的日期选择器为多目标水库调度系统提供了更强大的数据日期管理功能，主要包括：

1. **数据源日期范围显示** - 显示每个数据源的第一个和最后一个日期
2. **日期范围验证** - 确保用户选择的日期范围在所有数据的重合范围内
3. **双线性插值** - 根据模型的数据步长要求对数据进行插值处理

## 界面组成

### 1. 数据日期范围选择组
- **开始日期/结束日期选择器** - 用户可以选择数据的日期范围
- **应用日期范围按钮** - 应用选择的日期范围
- **重置为全部范围按钮** - 重置为所有数据源的公共日期范围
- **范围信息显示** - 显示当前选择的日期范围和数据源数量

### 2. 数据源日期范围信息组
- **数据源范围详情** - 显示每个数据源的详细日期信息
- **公共日期范围** - 显示所有数据源的公共可用日期范围
- **数据天数统计** - 显示每个数据源的数据天数和公共可用天数

### 3. 数据插值处理组
- **执行双线性插值按钮** - 对选中的数据进行插值处理
- **插值状态显示** - 显示插值处理的当前状态和结果

## 使用步骤

### 第一步：配置数据源
1. 在"数据配置"标签页中选择模型
2. 为每个水库配置数据源和列
3. 系统会自动检测所有数据源的日期范围

### 第二步：查看日期范围信息
1. 系统会自动显示"数据源日期范围信息"
2. 查看每个数据源的第一个和最后一个日期
3. 确认公共日期范围是否满足需求

### 第三步：选择日期范围
1. 在"开始日期"和"结束日期"中选择合适的日期范围
2. 确保选择的日期范围在所有数据源的重合范围内
3. 点击"应用日期范围"按钮

### 第四步：执行数据插值（可选）
1. 如果需要对数据进行插值处理，点击"执行双线性插值"按钮
2. 系统会根据选择的日期范围对数据进行线性插值
3. 插值完成后，数据会自动更新到数据管理器中

## 功能特点

### 1. 智能日期范围检测
- 自动检测所有数据源的日期范围
- 计算公共可用日期范围
- 防止用户选择超出数据范围的日期

### 2. 详细的数据源信息
- 显示每个数据源的名称和列名
- 显示第一个和最后一个日期
- 显示数据天数和可用天数

### 3. 双线性插值功能
- 支持对数值数据进行线性插值
- 自动处理缺失数据
- 生成连续的时间序列数据

### 4. 实时状态反馈
- 显示当前操作的状态
- 提供错误和警告信息
- 确认操作成功完成

## 注意事项

### 1. 日期范围选择
- 选择的日期范围必须在所有数据源的公共范围内
- 超出范围的日期选择会导致警告提示
- 建议使用"重置为全部范围"按钮来获得最佳范围

### 2. 数据插值
- 插值功能仅适用于数值数据
- 日期列不会被插值处理
- 插值结果会替换原始数据用于模型计算

### 3. 数据验证
- 系统会自动验证数据源的有效性
- 缺失或无效的数据源会被跳过
- 建议在插值前检查数据质量

## 技术实现

### 1. 日期范围计算
```python
# 计算所有数据源的公共日期范围
min_start = max([r['start'] for r in all_ranges])
max_end = min([r['end'] for r in all_ranges])
```

### 2. 双线性插值
```python
# 使用scipy.interpolate进行线性插值
from scipy.interpolate import interp1d
f = interp1d(x_original, y_original, kind='linear')
y_interpolated = f(x_target)
```

### 3. 数据存储
- 插值结果存储在数据管理器的`interpolated_data`中
- 模型运行时会优先使用插值数据
- 原始数据保持不变，可以随时恢复

## 故障排除

### 1. 日期范围错误
- **问题**：选择的日期范围超出数据源范围
- **解决**：使用"重置为全部范围"按钮，或检查数据源配置

### 2. 插值失败
- **问题**：双线性插值执行失败
- **解决**：检查数据是否为数值类型，确保日期列格式正确

### 3. 数据源缺失
- **问题**：某些数据源无法获取日期范围
- **解决**：检查数据源是否存在，确认列名是否正确

## 更新日志

### v2.0.0 (当前版本)
- ✅ 新增数据源日期范围显示功能
- ✅ 新增日期范围验证功能
- ✅ 新增双线性插值功能
- ✅ 优化用户界面和交互体验
- ✅ 增强错误处理和状态反馈

### v1.0.0 (原版本)
- 基础日期范围选择功能
- 简单的日期过滤器
- 基本的数据验证
