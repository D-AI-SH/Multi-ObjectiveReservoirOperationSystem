# 多目标水库调度系统打包说明

## 概述

本文档说明如何将多目标水库调度系统打包成独立的可执行文件，保留所有功能包括：
- 完整的GUI界面
- AI聊天功能（向量检索）
- 数据管理和处理
- 模型计算和优化
- 可视化功能

## 环境要求

### 系统要求
- Windows 10/11 (64位)
- 至少8GB内存
- 至少5GB可用磁盘空间

### 软件要求
- Python 3.8+
- Conda环境 `hydro`
- 所有项目依赖包

## 打包步骤

### 1. 环境准备

```bash
# 激活conda环境
conda activate hydro

# 确保所有依赖已安装
pip install -r requirements.txt

# 安装PyInstaller
pip install pyinstaller
```

### 2. 执行打包

```bash
# 运行打包脚本
python build.py
```

### 3. 打包过程说明

打包脚本会自动执行以下步骤：

1. **环境检查** - 验证Python版本和依赖包
2. **清理构建目录** - 删除之前的构建文件
3. **API密钥清理** - 自动清理配置文件中的敏感信息
4. **构建可执行文件** - 使用PyInstaller打包
5. **构建后清理** - 恢复API密钥并清理临时文件

## 打包配置说明

### 包含的文件和目录

- **数据文件**: `data/` 目录下的所有文件
  - 向量数据库文件 (`manual_faiss.index`, `manual_meta.pkl`)
  - 水库数据文件 (`reservoirs/` 目录)
  - 示例数据文件
  - 数据库文件 (`project_database.db`)

- **配置文件**: 清理后的配置文件
  - `data_links_config.json`
  - `saint_venant_config.json`
  - `ai_performance_config_commented.json`

- **UI资源**: `uiLAYER/assets/` 目录
  - 图标文件
  - 样式文件
  - 其他UI资源

- **文档文件**: 使用手册和说明文档

### 排除的内容

- **API密钥**: 自动清理配置文件中的敏感信息
- **开发文件**: 测试文件、开发工具等
- **虚拟环境**: `venv/` 目录
- **模型文件**: `models/` 目录（运行时动态加载）

### 隐藏导入模块

打包配置包含了所有必要的隐藏导入：
- PyQt6相关模块
- 科学计算库 (numpy, pandas, scipy等)
- 机器学习库 (sentence_transformers, faiss等)
- 优化算法库 (pymoo)
- Web相关库 (flask, dash等)

## 输出文件

打包完成后，在 `dist/` 目录下会生成：
- `多目标水库调度系统.exe` - 主可执行文件
- 相关依赖库和资源文件

## 使用说明

### 首次运行

1. 双击 `多目标水库调度系统.exe` 启动程序
2. 程序会自动创建必要的配置文件
3. 在AI配置中设置您的API密钥

### 功能验证

打包后的程序应包含以下功能：
- ✅ 数据管理界面
- ✅ 模型配置和运行
- ✅ 调度优化计算
- ✅ 结果可视化
- ✅ AI聊天助手（需要配置API密钥）
- ✅ 向量检索功能
- ✅ 数据导入导出

## 故障排除

### 常见问题

1. **程序无法启动**
   - 检查是否缺少Visual C++ Redistributable
   - 确认系统架构匹配（64位）

2. **AI功能无法使用**
   - 在程序内配置API密钥
   - 检查网络连接

3. **数据文件缺失**
   - 确认打包时包含了所有数据文件
   - 检查文件路径是否正确

4. **性能问题**
   - 首次运行可能较慢（模型加载）
   - 确保有足够的内存和磁盘空间

### 调试模式

如需调试，可以修改 `build_config.spec` 文件：
```python
console=True,  # 显示控制台窗口
debug=True,    # 启用调试模式
```

## 文件大小说明

打包后的程序可能较大（约2-3GB），主要原因：
- PyQt6及其依赖库
- 科学计算库 (numpy, scipy, pandas等)
- 机器学习库 (sentence_transformers, torch等)
- 优化算法库 (pymoo)
- 数据文件和向量数据库

这是正常现象，确保了程序的完整性和独立性。

## 安全说明

- 打包前会自动清理API密钥
- 打包后需要用户手动配置API密钥
- 不会泄露任何敏感信息

## 技术支持

如遇到打包问题，请检查：
1. Python环境和依赖包版本
2. 系统架构和权限
3. 磁盘空间和内存
4. 网络连接（下载依赖时）

---

**注意**: 首次打包可能需要较长时间，请耐心等待。建议在打包前关闭杀毒软件，避免误报。